function setMovieValues(t){return t.map(function(t){t.poster_path=constants.poster_size+t.poster_path,t.popular=!0,Movie.findOne({id:t.id},function(e,n){return e?!1:void(null==n&&Movie.create(t,function(t,e){return t?!1:void 0}))})}),!0}function findMovieInArray(t,e){return t.map(function(t){return t.id==e.id?!0:void 0}),!1}var Movie=require("../models/Movie.js"),http=require("http"),constants=require("../helpers/constants");module.exports={getPopularMovies:function(t,e){Movie.find({popular:!0},function(t,n){return t?e.status(500).json({message:"Server error"}):e.status(200).json(n)})},getMovie:function(t,e){Movie.findOne({id:t.params.id},function(t,n){return t?e.status(500).json({message:"Server error"}):e.status(200).json(n)})},updateMovie:function(t,e){},addPopular:function(t,e){http.get(constants.popular_movies,function(t){console.log("Respuesta correcta "+t.statusCode);var n="";t.on("data",function(t){n+=t}),t.on("end",function(){try{n=JSON.parse(n.toString()),Movie.find({},function(t,o){if(t)return e.status(500).json({ERROR:"Error creating movies"});var s=[];return o.length>0?(s=[],n.results.map(function(t){return findMovieInArray(o,t)?(console.log("Ya esta almacenada"),null):void s.push(t)}),setMovieValues(s)?e.status(200).json({SUCCESS:"Success creating movies"}):e.status(500).json({ERROR:"Error creating movies"})):(s=[],n.results.map(function(t){s.push(t)}),setMovieValues(s)?e.status(200).json({SUCCESS:"Success creating movies"}):e.status(500).json({ERROR:"Error creating movies"}))})}catch(t){console.log(t)}})})}};